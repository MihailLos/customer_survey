import streamlit as st

st.set_page_config(page_title="Опрос о маркировке пищевой продукции", layout="centered")

if "page" not in st.session_state:
    st.session_state.page = 0

def go_next():
    st.session_state.page += 1

def go_back():
    st.session_state.page -= 1

# --- Страница 0: Приветствие ---
if st.session_state.page == 0:
    st.title("Добро пожаловать в опрос!")
    st.markdown("#### Исследование потребительских предпочтений при выборе пищевой продукции")
    st.markdown("**Цель опроса** — выявить ключевые факторы, влияющие на выбор продуктов питания на основе маркировки.")
    st.markdown("Опрос займет не более 5–7 минут. Ваши ответы анонимны и будут использованы исключительно в исследовательских целях.")
    st.button("Начать опрос", on_click=go_next)

# --- Страница 1: Вопросы 1–3 ---
elif st.session_state.page == 1:
    st.header("Блок 2. Вопросы о потребительском поведении")

    st.radio("1. Как часто Вы покупаете пищевую продукцию?", 
             ["Каждый день", "Несколько раз в неделю", "Один раз в неделю", "Реже одного раза в неделю"], key="q1")

    st.markdown("2. Где чаще всего Вы приобретаете пищевую продукцию? (можно выбрать несколько вариантов)")
    q2_selected = []
    for option in ["Супермаркеты", "Магазины 'у дома'", "Ларьки/киоски", "Рынки", "Онлайн-сервисы доставки", "Другое"]:
        if st.checkbox(option, key=f"q2_{option}"):
            q2_selected.append(option)
    if "Другое" in q2_selected:
        st.text_input("Уточните, что вы имели в виду под 'Другое':", key="q2_other")

    st.text_input("3. Элемент 1 маркировки, который должен быть выделен:", key="q3_1")
    st.text_input("Элемент 2 маркировки, который должен быть выделен:", key="q3_2")
    st.text_input("Элемент 3 маркировки, который должен быть выделен:", key="q3_3")

    col1, col2 = st.columns(2)
    with col1:
        st.button("Назад", on_click=go_back)
    with col2:
        st.button("Далее", on_click=go_next)

# --- Страница 2: Вопросы 4–12 (MaxDiff) ---
elif st.session_state.page == 2:
    st.header("Блок 2. MaxDiff: важность информации на упаковке")

    for i in range(4, 13):
        st.markdown(f"**Вопрос {i}**")
        st.radio(f"Наиболее важная информация:", [f"{j+1}" for j in range(4)], key=f"m{i}")
        st.radio(f"Наименее важная информация:", [f"{j+1}" for j in range(4)], key=f"l{i}")

    col1, col2 = st.columns(2)
    with col1:
        st.button("Назад", on_click=go_back)
    with col2:
        st.button("Далее", on_click=go_next)

# --- Страница 3: Вопросы 13–19 ---
elif st.session_state.page == 3:
    st.header("Блок 2. Дополнительные поведенческие вопросы")

    st.radio("13. Насколько Вы осведомлены о содержании нутриентов?",
             ["Хорошо ориентируюсь", "Частично понимаю", "Знаю общие принципы", "Не обращаю внимания"], key="q13")

    st.radio("14. Насколько для Вас важна информация о пользе продукции для здоровья?",
             ["Очень важно", "Скорее важно", "Не имеет значения"], key="q14")

    st.radio("15. Часто ли Вы сталкиваетесь с трудностями при покупке продукции?",
             ["Да, регулярно", "Иногда", "Нет"], key="q15")

    st.radio("16. Обращаете ли Вы внимание на специализированную продукцию?",
             ["Да, это важно", "Иногда обращаю внимание", "Нет, не обращаю внимание"], key="q16")

    st.markdown("17. Какой информацией Вы хотели бы пользоваться при выборе продукции? (можно выбрать несколько вариантов)")
    q17_selected = []
    for option in ["Рейтинги качества", "Сравнение цен", "Анализ состава", "Отзывы", "Рекомендации по здоровому питанию", "Другое"]:
        if st.checkbox(option, key=f"q17_{option}"):
            q17_selected.append(option)
    if "Другое" in q17_selected:
        st.text_input("Уточните, что вы имели в виду под 'Другое':", key="q17_other")

    st.radio("18. Читаете ли Вы информацию на упаковке перед покупкой?",
             ["Всегда внимательно изучаю", "Смотрю, но не углубляюсь", 
              "Читаю только при выборе новой продукции", "Не обращаю внимания"], key="q18")

    st.radio("19. Хотели бы вы пользоваться цифровой системой подбора продукции?",
             ["Да", "Нет", "Затрудняюсь ответить"], key="q19")

    col1, col2 = st.columns(2)
    with col1:
        st.button("Назад", on_click=go_back)
    with col2:
        st.button("Далее", on_click=go_next)

# --- Страница 4: Социально-демографический блок (20–27) ---
elif st.session_state.page == 4:
    st.header("Блок 3. Социально-демографический")

    st.radio("20. Пол", ["Мужской", "Женский"], key="q20")
    st.radio("21. Возрастная категория", ["18–29 лет", "30–39 лет", "40–49 лет", "50–59 лет", "60 лет и выше"], key="q21")

    q22_value = st.radio("22. Образование", 
             ["Школа", "Неоконченное среднее специальное", "Колледж / техникум", "Неоконченное высшее",
              "Бакалавриат / специалитет", "Магистратура / аспирантура", "Другое"], key="q22")
    if q22_value == "Другое":
        st.text_input("Уточните ваше образование:", key="q22_other")

    q23_value = st.radio("23. Род занятий", 
             ["Учащийся / студент", "Работающий (наёмный)", "Самозанятый / предприниматель",
              "Пенсионер", "Безработный", "Другое"], key="q23")
    if q23_value == "Другое":
        st.text_input("Уточните ваш род занятий:", key="q23_other")

    st.radio("24. Семейное положение", ["Состою в браке", "Не состою в браке"], key="q24")
    st.radio("25. Сколько человек проживает с Вами?", 
             ["Один", "1 человек", "2 человека", "3 человека", "4 человека", "5 и более"], key="q25")
    st.radio("26. Насколько комфортно Вам покрывать расходы на питание?",
             ["Очень комфортно", "Достаточно комфортно", "Затруднительно", "Очень сложно"], key="q26")
    st.radio("27. Есть ли у вас дети до 18 лет?", ["Да", "Нет"], key="q27")

    if st.button("Отправить анкету"):
        st.success("Спасибо за участие в опросе! Ваши ответы сохранены.")

    st.button("Назад", on_click=go_back)
